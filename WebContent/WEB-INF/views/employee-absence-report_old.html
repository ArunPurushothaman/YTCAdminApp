<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="description" content="Program Details Form Wizard">
      <meta name="author" content="Yokohama">
      <meta name="keyword" content="YMPACT">
      <title>YTMM</title>
     <!-- Bootstrap core CSS -->
    <link href="resources/css/bootstrap.min.css" rel="stylesheet">
    <link href="resources/css/bootstrap-reset.css" rel="stylesheet">
    <!--external css-->
    <link href="resources/assets/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
     <!--dynamic table-->
    <link href="resources/assets/advanced-datatable/media/css/demo_page.css" rel="stylesheet" />
    <link href="resources/assets/advanced-datatable/media/css/demo_table.css" rel="stylesheet" />
    <link rel="stylesheet" href="resources/assets/data-tables/DT_bootstrap.css" />

      <!--right slidebar-->
      <link href="resources/css/slidebars.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="resources/css/style.css" rel="stylesheet">
    <link href="resources/css/style-responsive.css" rel="stylesheet" />
    <link href="resources/css/status_icons.css" rel="stylesheet">


    <!-- HTML5 shim and Respond.js IE8 support of HTML5 tooltipss and media queries -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
    <![endif]-->
     <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
	<script src="https://cdn.datatables.net/1.10.4/js/jquery.dataTables.min.js"></script>
	<!-- <link rel="stylesheet" href="https://cdn.datatables.net/1.10.4/css/jquery.dataTables.min.css"> -->
	
 <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	 <link rel="stylesheet" href="https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css">
	<link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.3.1/css/buttons.dataTables.min.css">
	
	<link rel="stylesheet" href="resources/css/breadcrumbs.css">
	<!-- <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script> -->	
    
   </head>
   <body onload="">
      <section id="container" class="">
         <!--header start-->
         <header class="header dark-bg">
            <div class="sidebar-toggle-box">
               <i class="fa fa-bars"></i>
            </div>
            <!--logo start-->
            <a href="" class="logo"><img src="resources/img/yokohama-logo.svg" width="132" height="52"></a>
            <!--logo end-->
            <div class="top-nav ">
               <ul class="nav pull-right top-menu">
                  <!-- user login dropdown start-->
                  <li class="dropdown">
                     <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                     <span class="username" id="loginUserName">John Doe</span>
                     <b class="caret"></b>
                     </a>
                     <ul class="dropdown-menu extended logout">
                        <div class="log-arrow-up"></div>
                        <li><a href="logout"><i class="fa fa-key"></i> Log Out</a></li>
                     </ul>
                  </li>
                  <!-- user login dropdown end -->
               </ul>
               <center><h3 style="color:white;font-size: 20px;"></h3></center>
            </div>
         </header>
         <!--header end-->
         <!--sidebar start-->
		<aside>
			<div id="sidebar"  class="nav-collapse ">
				<!-- sidebar menu start-->
				<ul class="sidebar-menu" id="nav-accordion">
				  <li>
					  <a class="" href="processLogin">
						  <i class="fa fa-tasks"></i>
						  <span>Employee Report Off Form</span>
					  </a>
				  </li>	
				   <li>
					 <a class="" href="absenceHistory">
						  <i class="fa fa-tasks"></i>
						  <span>Absence History</span>
					  </a>
				  </li>			  
				</ul>
				<!-- sidebar menu end-->
			</div>
		</aside>
         <!--sidebar end-->
         <!--main content start-->
         <section id="main-content">
            <section class="wrapper site-min-height">
               <!-- page start-->
                <div id="tirekey-parent-div" class="row">
                  <div class="col-lg-12">
                     <!--progress bar start-->
                     <section class="panel">
                        <header class="panel-heading">
                           <h3>YTMM Employee Call-Off Report</h3>
                        </header>
                        <div class="panel-body">
                              
                          <!-- <h4 class="tableHeader">Absent Entry</h4>  -->
                          
                           <form id="wizard-validation-form" class="cmxform" action="#">
                          <div class="clearfix">
										<div class="form-group clearfix">
											
											<div class="col-lg-12">
                                             <div>
<!--                                                 <label class="control-label" for="employeeName" style="margin-right: 10px;">Employee Name</label>
                                                <input type="text" class="form-control radio-inline " id="employeeName" name="employeeName" placeholder="Employee Name"  style="width: 200px;" disabled>   -->                                             
												   
												   <div class="col-lg-4 col-sm-4" style="width:38%">
																<label class="control-label" for="from">Begin / End
																	Dates:</label>
																<div class="input-group input-medium"
																	data-date-format="mm/dd/yy">
																	<input type="text" class="form-control"  id="from"
																		name="from" placeholder="Begin Date" >
																		<span class="input-group-addon"><img id="calImgfrom" src="resources/img/email-img/calendar.png" width="15" onclick="openCalendar(this);"></span>																		
																		<span class="input-group-addon" for="to">To</span> <input
																		type="text" class="form-control"  id="to"
																		name="to" placeholder="End Date" >
																		<span class="input-group-addon"><img id="calImgto" src="resources/img/email-img/calendar.png" width="15" onclick="openCalendar(this);"></span>	
																</div>
																<label for=from generated="true" class="error"></label>
																<label for="to" generated="true" class="error" style="float:right"></label> 
																
															</div>
															
															<div class="col-lg-4 col-sm-4">
															<label class="control-label"
																for="employee_name_inputselect">Employee Name</label> 
																 <input type="text" class="form-control radio-inline " id="employeeName" name="employeeName" placeholder="Employee Name"   disabled>                                               
												   
														</div>

												<a href="#" id="run_report" onclick="generateExcel();"><button class="btn btn-default" style="margin-top:20px"> Run Report</button></a>
                                             </div>                                             
											           
										</div>											
										</div>
									</div>
                          
                         
										
																			
                   <div class="col-lg-12">
					<div class="modal fade" id="myModal5" tabindex="-1"
					role="dialog" aria-labelledby="myModalLabel"
					aria-hidden="true" data-backdrop="static"
					data-keyboard="false">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button id="program-error-modal-close" type="button"
									class="close" data-dismiss="modal"
									aria-hidden="true">&times;</button>
								<h4 class="modal-title">Error / Warning (s)</h4>
							</div>
							<div class="modal-body">
								<!-- <div class="space15">&nbsp;</div> -->
								<div class="text-center">
									<span id="errorMessageModal"></span>
								</div>
								<!-- <div class="space15"></div> -->
							</div>
							<div class="modal-footer">
								<button class="btn btn-info" type="button"
									id="program-error-modal-ok" data-dismiss="modal">
									<i class="fa fa-save"></i>&nbsp;&nbsp;OK
								</button>
							</div>
						</div>
					</div>
				</div>
				
				<div class="modal fade" id="statusbox" tabindex="-1"
					role="dialog" aria-labelledby="myModalLabel"
					aria-hidden="true" data-backdrop="static"
					data-keyboard="false">
					<div class="modal-dialog">
						<div class="modal-content"
							style="border: thin solid grey">
							<div class="modal-header">
								<h4 class="modal-title">Status</h4>
							</div>
							<div class="modal-body">
								<!-- <div class="space15">&nbsp;</div> -->
								<div class="text-center">
									<span>Please wait, while your request is
										being processed.<br>
									<img src="resources/img/Processing.gif">
									</span>
								</div>
								<!-- <div class="space15"></div> -->
							</div>

						</div>
					</div>
				</div>
				
				<div class="modal fade" id="myModal2" tabindex="-1"
                  role="dialog" aria-labelledby="myModalLabel"
                  aria-hidden="true">
                  <div class="modal-dialog">
                     <div class="modal-content" style="border: thin solid grey">
                        <div class="modal-header">
                           <button id="program-confirmation-modal-close"
                              type="button" class="close" data-dismiss="modal"
                              aria-hidden="true">&times;</button>
                           <h4 class="modal-title">Confirmation</h4>
                        </div>
                        <div class="modal-body">
                           <!-- <div class="space15">&nbsp;</div> -->
                           <div class="text-center">
                              <span id="confirmMessage"></span>
                           </div>
                           <!-- <div class="space15"></div> -->
                        </div>
                        <div class="modal-footer">
                          <a href="javascript: cancel()" <button class="btn btn-info" type="button"
                              id="program-confirmation-modal-ok"
                              data-toggle="modal" href="#myModal2">
                              <i class="fa fa-save"></i>&nbsp;&nbsp;OK
                           </button></a>
                        </div>
                     </div>
                  </div>
                </div>  
				
                                        <div class="row">
                                            <div class="space15 clearfix"></div>
                                  

      <!-- END Review / Confirm Section -->
      </div>
       </form>
        </div>
      </section><!-- end panel section -->
      </div>
      </div>
      <!-- page end-->
      </section><!-- end wrapper site-min-height -->
      </section><!-- end #maincontent -->
      <!--main content end-->
          
      <!--footer start-->
      <footer class="site-footer">
         <div class="text-center">
            2017 &copy; Yokohama Tire Corporation. All rights reserved. The Yokohama Rubber Company Limited
            <a href="#" class="go-top">
            <i class="fa fa-angle-up"></i>
            </a>
         </div>
      </footer>
      <!--footer end-->
      </section>
      <!-- END section id="container" FIRST section after opening body tag  -->
       
     <!-- js placed at the end of the document so the pages load faster -->
   <!--  <script src="js/jquery.js"></script> -->
    <script src="resources/js/jquery-ui-1.9.2.custom.min.js"></script>
    <script src="resources/js/jquery-migrate-1.2.1.min.js"></script>
    <script src="resources/js/bootstrap.min.js"></script>
    <script class="include" type="text/javascript" src="resources/js/jquery.dcjqaccordion.2.7.js"></script>
    <script src="resources/js/jquery.scrollTo.min.js"></script>
    <script src="resources/js/jquery.nicescroll.js" type="text/javascript"></script>
    <script type="text/javascript" src="resources/assets/data-tables/jquery.dataTables.js"></script>
    <script type="text/javascript" src="resources/assets/data-tables/DT_bootstrap.js"></script>
    <script src="resources/js/respond.min.js" ></script>
    <!--select2-->
    <script type="text/javascript" src="resources/assets/select2/js/select2.min.js"></script>
     <!--Form Validation-->
    <script src="resources/js/bootstrap-validator.min.js" type="text/javascript"></script>
      <!--Form Wizard-->
      <!--script src="js/jquery.steps.min.js" type="text/javascript"></script-->
    <script src="resources/js/jquery.validate.min.js" type="text/javascript"></script>
    <!-- time out -->
    <script src="resources/js/jquery.userTimeout.js"></script>
    <!--right slidebar-->
    <script src="resources/js/slidebars.min.js"></script>
    <!--dynamic table initialization -->
    <script src="resources/js/dynamic_table_init.js"></script>
    <!--common script for all pages-->
    <script src="resources/js/common-scripts.js"></script>
      
	

      <script type="text/javascript">
      $(document).ready(function () {
    	  
    	  function validateDate(txtDate)
			{
				var currVal = txtDate;
			    if(currVal == '')
			        return false;
			    
			  //var rxDatePattern = /^(\d{1,2})(\/|-)(\d{1,2})(\/|-)(\d{4})$/; //Declare Regex
			    var rxDatePattern = /^(\d{1,2})(\/|-)(\d{1,2})(\/|-)(\d{4}|\d{2})$/; //Declare Regex
			    var dtArray = currVal.match(rxDatePattern); // is format OK?
			    
			    if (dtArray == null) {
			    	 return false;
			    }else{
			    //Checks for mm/dd/yyyy format.
			    dtMonth = dtArray[1];
			    dtDay= dtArray[3];
			    dtYear = dtArray[5];        
			    if(dtYear.length==2){
			    	dtYear=20+dtYear;
			    }
			    if (dtMonth < 1 || dtMonth > 12) 
			    	 return false;
			    else if (dtDay < 1 || dtDay> 31) 
			    	 return false;
			    else if ((dtMonth==4 || dtMonth==6 || dtMonth==9 || dtMonth==11) && dtDay ==31) 
			    	 return false;
			    else if (dtMonth == 2) 
			    {
			        var isleap = (dtYear % 4 == 0 && (dtYear % 100 != 0 || dtYear % 400 == 0));
			        if (dtDay> 29 || (dtDay ==29 && !isleap)) 
			        	 return false;
			    }
			    }			    
			    return true;
			}
    	  
    		$.validator.addMethod("checkDate", function (value, element) {
				return validateDate(value);
			}, "Please enter date in mm/dd/yyyy or mm/dd/yy format");
      
        $("#wizard-validation-form").validate({
			onsubmit: false,
			rules: {
				employeeName: {
					required: true
				},				
				to:{
					required: true,
					checkDate:true
				},
				from:{
					required: true,
					checkDate:true
				}
				
			},
			messages: {
				required: "This field is required",
			}
		});
      
	  var nowTemp = new Date();
	  
	  var now = new Date(nowTemp.getFullYear(), nowTemp.getMonth(), nowTemp.getDate(), 0, 0, 0, 0);
	  $('#from').val(getDate(now));
	  $('#to').val(getDate(now));
        
	  $( "#wizard-validation-form" ).submit(function( event ) {
    	  event.preventDefault();
    	});
      
      });
      
      

	  

      
		var toInt=false;
		var fromInt=false;
      
      function openCalendar(event){
			var id=(event.id).substring(6);
			if((id=='to')&&(!toInt)){
				toInt=true;
				 $('#to').datepicker({
		            	autoclose: true,
		            	forceParse: false,
		            	}).on('hide', function(e){
		        			if($(this).val()){
		        			$(this).valid();
		     	   		//validateDate($(this));
		    				}
		        	}); 
			}
			if((id=='from')&&(!fromInt)){
				fromInt=true;
				 $('#from').datepicker({
		            	autoclose: true,
		            	forceParse: false,
		            	}).on('hide', function(e){
		        			if($(this).val()){
		        		$(this).valid();	
		     	   		//validateDate($(this));
		    				}
		        	}); 
			}

			$('#'+id).datepicker('show');
		}
      
      function cancel(){
          window.location.href = "report";

      }
		
		
		function getDate(date){
			var today = new Date(date);
			var dd = today.getUTCDate();
			var mm = today.getUTCMonth()+1; //January is 0!
			var yyyy = today.getUTCFullYear();

			if(dd<10) {
			    dd='0'+dd
			} 

			if(mm<10) {
			    mm='0'+mm
			}  

			today = mm+'/'+dd+'/'+yyyy;
			return today;
		}
      
      function generateExcel(){    	
    	  $('#statusbox').modal('show');
    	  if($("#wizard-validation-form").valid()){
				
 	    	 var report=new Object();
 	    	 report.empName=$('#employeeName').val();
 	    	 report.startDate=$('#from').val();
 	    	 report.endDate=$('#to').val();
 	    	 
 	    	 if (navigator.userAgent.indexOf('Trident')>0 || navigator.userAgent.indexOf('Edge')>0)
 		    	{
 					var request = new XMLHttpRequest();
 					request.open("POST", '/YTMM/report/v1/generateReport', true);
 					request.responseType = "blob";
 					request.setRequestHeader('Content-type', 'application/json; charset=utf-8');
 					request.onload = function (e) {
 						if (this.status === 200) {
 							// `blob` response

 							var fileName="Report"+"_"+$("#loginUserName").html()+"_"+new Date().toLocaleString(); 
 							window.navigator.msSaveOrOpenBlob(this.response, fileName + '.xlsx'); 
 							$('#statusbox').modal('hide');
 						}
 					};
 					request.onreadystatechange = function (oEvent) { 
 					    if (request.readyState === 4) {  
 					        if (request.status != 200) {  
 						        message = errMessage+ "<br> <strong> Server Status :</strong> " + request.status + "<br><strong> Error Description :</strong>" + request.statusText + "<br>";
 								$('#statusbox').modal('hide');
 								$("#errorMessageModal").html(message);
 								//$('#myModal2').modal('toggle');
 					        }  
 					    }  
 					}
 					request.send(JSON.stringify(report));
 		    	}
 		    	else
 		    	{
 					var request = new XMLHttpRequest();
 					request.open("POST", '/YTMM/report/v1/generateReport', true); 
 					request.responseType = "blob";
 					request.setRequestHeader('Content-type', 'application/json; charset=utf-8');
 					request.onload = function (e) {
 					    if (this.status === 200) {

 					        // create `objectURL` of `this.response` : `.pdf` as `Blob`
 					        var file = window.URL.createObjectURL(this.response);
 					        var a = document.createElement("a");
 					        var fileName="Report"+"_"+$("#loginUserName").html()+"_"+new Date().toLocaleString();
 					        a.href = file;
 					        a.download = this.response.name || fileName + '.xlsx';
 					        document.body.appendChild(a);
 					        a.click();
 					       $('#statusbox').modal('hide');
 						}
 					}
 					request.onreadystatechange = function (oEvent) { 
 					    if (request.readyState === 4) {  
 					        if (request.status != 200) {  
 						        message = errMessage+ "<br> <strong> Server Status :</strong> " + request.status + "<br><strong> Error Description :</strong> " + request.statusText + "<br>";
 								$('#statusbox').modal('hide');
 								$("#errorMessageModal").html(message);
 								//$('#myModal2').modal('toggle');
 					        }  
 					    }  
 					}
 					request.send(JSON.stringify(report));
 			  	}	
    		  
			}
			else{
				$("#errorMessageModal").html("Please correct the highlighted errors.");
				$('#myModal5').modal('toggle');
			}
	    	

     	}
  	  
      
      $( function() {
    	 
    	  $.ajax({ 
          	type: "GET",
          	dataType: "json",
         	url: '/YTMM/v1/getAllEmployeeDetails',
          	success: function(response){
          		 var availableTags = response;
           	   $( "#employeeName" ).autocomplete({
           	      source: availableTags
           	    });
           	 
          	},
          	failure: function(response){
          		alert("Wrongly done");
          	}
      	});  	  
    	     	
		  
    });
      
       
      
		
      </script>
		<script type="text/javascript" th:inline="javascript">
			$(document).ready(function() {			
				var modelAttributeValue = [[${loginUserNameValue}]];
				$("#loginUserName").html(modelAttributeValue);
				 var emp = [[${EmployeeInfo}]];
		 		   if((1==emp[0].ROLE_ID)||(2==emp[0].ROLE_ID)){		 			
		 			  $('#employeeName').prop('disabled', false);
		 		   }else{
		 			  $('#employeeName').val(modelAttributeValue); 
		 		   }
			});
		</script>
       <!-- END JAVASCRIPTS -->
   </body>
</html>