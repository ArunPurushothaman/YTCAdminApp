<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="description" content="Program Details Form Wizard">
      <meta name="author" content="Yokohama">
      <meta name="keyword" content="YMPACT">
      <title>YTMM</title>
     <!-- Bootstrap core CSS -->
    <link href="resources/css/bootstrap.min.css" rel="stylesheet">
    <link href="resources/css/bootstrap-reset.css" rel="stylesheet">
    <!--external css-->
    <link href="resources/assets/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
     <!--dynamic table-->
    <link href="resources/assets/advanced-datatable/media/css/demo_page.css" rel="stylesheet" />
    <link href="resources/assets/advanced-datatable/media/css/demo_table.css" rel="stylesheet" />
    <link rel="stylesheet" href="resources/assets/data-tables/DT_bootstrap.css" />

      <!--right slidebar-->
      <link href="resources/css/slidebars.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="resources/css/style.css" rel="stylesheet">
    <link href="resources/css/style-responsive.css" rel="stylesheet" />
    <link href="resources/css/status_icons.css" rel="stylesheet">


    <!-- HTML5 shim and Respond.js IE8 support of HTML5 tooltipss and media queries -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
    <![endif]-->
     <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
	<script src="https://cdn.datatables.net/1.10.4/js/jquery.dataTables.min.js"></script>
	<!-- <link rel="stylesheet" href="https://cdn.datatables.net/1.10.4/css/jquery.dataTables.min.css"> -->
	
 <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	 <link rel="stylesheet" href="https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css">
	<link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.3.1/css/buttons.dataTables.min.css">
	
	<link rel="stylesheet" href="resources/css/breadcrumbs.css">
	<!-- <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script> -->
	<style>
		td,th {
		    white-space:nowrap;
		}
		th{
				text-align: center;
		}
	</style>
  <script type="text/javascript">
   //Export to Excel 
   function tableToExcel(tableId) {
    var tab_text="<table border='2px'><tr>";
    var textRange; var j=0;
    var fileName = "";
      tab = document.getElementById(tableId); // id of table
      
      if(tableId=="absence_histroy"){

        fileName="ABSENCE_HISTORY_"+$("#loginUserName").html()+"_"+new Date().toLocaleString();
        
      }

      for(j = 0 ; j < tab.rows.length ; j++) {  
        var table_cells = tab.rows[j].getElementsByTagName('td');  
        for (var i = 0; i < table_cells.length; i++) { 
          var cell = table_cells[i];
          /* if(  i==0) {
            if(cell.innerHTML!='0') {
            	cell.setAttribute("style", 'mso-number-format:"\@"');
            }
          }
          
          if(  i==6) {              
              	cell.setAttribute("style", 'width:"320px"');
            } */
          
        }
        var text="";
       
        
        /* Code added to change background color of failed records in excel */
        /*  if((j!=0)&&(tab.rows[j].getElementsByTagName('td').length>1)){
	        if(tab.rows[j].getElementsByTagName('td')[7].innerHTML=="Failed"){  
	        	tab.rows[j].innerHTML=tab.rows[j].innerHTML.replace(/<td/g,'<td style="background-color: #eec9c9"');
	        	tab.rows[j].getElementsByTagName('td')[0].setAttribute("style", 'mso-number-format:"\@";background-color: "#eec9c9"');
	        }
        }  */
        text=tab.rows[j].innerHTML;
        tab_text=tab_text+text+"</tr>";
      }
      tab_text=tab_text+"</table>";
      tab_text= tab_text.replace(/<a[^>]*>|<\/a>/g, "");//remove if u want links in your table
      tab_text= tab_text.replace(/<img[^>]*>/gi,""); // remove if u want images in your table
      tab_text= tab_text.replace(/<input[^>]*>|<\/input>/gi, ""); // reomves input params
      tab_text= tab_text.replace(/(width: )\d+px;/g, "background-color: #87AFC6");
      if (navigator.userAgent.indexOf('Trident')>0 || navigator.userAgent.indexOf('Edge')>0) {
        var blobObject = new Blob([tab_text]); 
        window.navigator.msSaveOrOpenBlob(blobObject, fileName+'.xls');
      }else {
        var a = document.createElement('a');
       /*  var data_type = 'data:application/vnd.ms-excel';
        a.href = data_type + ', ' + encodeURIComponent(tab_text); */
        var blob = new Blob([tab_text], {type: 'text/xls'});
        a.href =window.URL.createObjectURL(blob);
        a.download =  fileName+'.xls';
        document.body.appendChild(a);
        a.click();
        document.body.appendChild(a);   
      }

    }
  </script>	
    
   </head>
   <body onload="">
      <section id="container" class="">
         <!--header start-->
         <header class="header dark-bg">
            <div class="sidebar-toggle-box">
               <i class="fa fa-bars"></i>
            </div>
            <!--logo start-->
            <a href="" class="logo"><img src="resources/img/yokohama-logo.svg" width="132" height="52"></a>
            <!--logo end-->
            <div class="top-nav ">
               <ul class="nav pull-right top-menu">
                  <!-- user login dropdown start-->
                  <li class="dropdown">
                     <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                     <span class="username" id="loginUserName">John Doe</span>
                     <b class="caret"></b>
                     </a>
                     <ul class="dropdown-menu extended logout">
                        <div class="log-arrow-up"></div>
                        <li><a href="logout"><i class="fa fa-key"></i> Log Out</a></li>
                     </ul>
                  </li>
                  <!-- user login dropdown end -->
               </ul>
               <center><h3 style="color:white;font-size: 20px;"></h3></center>
            </div>
         </header>
         <!--header end-->
         <!--sidebar start-->
		<aside>
			<div id="sidebar"  class="nav-collapse ">
				<!-- sidebar menu start-->
				<ul class="sidebar-menu" id="nav-accordion">
				  <li>
					  <a class="" href="processLogin">
						  <i class="fa fa-tasks"></i>
						  <span>Employee Report Off Form</span>
					  </a>
				  </li>				  
				</ul>
				<!-- sidebar menu end-->
			</div>
		</aside>
         <!--sidebar end-->
         <!--main content start-->
         <section id="main-content">
            <section class="wrapper site-min-height">
               <!-- page start-->
                <div id="tirekey-parent-div" class="row">
                  <div class="col-lg-12">
                     <!--progress bar start-->
                     <section class="panel">
                        <header class="panel-heading">
                           <h3>YTMM Employee Call/Report-Off Enquiry</h3>
                        </header>
                        <div class="panel-body">
                              
                          <!-- <h4 class="tableHeader">Absent Entry</h4>  -->
                          
                          
                          <div class="clearfix">
										<div class="form-group clearfix">
											
											<div class="col-lg-12">
                                             <div>
                                                <label class="control-label" for="employeeName" style="margin-right: 10px;">Employee Name</label>
                                                <input type="text" class="form-control radio-inline " id="employeeName" name="employeeName" placeholder="Employee Name"  style="width: 200px;" disabled>                                               
												<a href="#" id="run_report" onclick="runReport();"><button class="btn btn-default"> Run Report</button></a>
                                             </div>
                                             
                                             <!-- <div class="col-lg-4 col-sm-4" style="width:25%">
                                 						 	<a href="#" id="run_report" onclick="runReport();"><button class="btn btn-default" style="margin-top: 20px;"> Run Report</button></a>
                              							</div> -->
											           
										</div>
											<div class="btn-group pull-right">
												<div class="btn-group">
													<a href="#" class="m-bot15">
														<button class="btn btn-default"
															onclick="tableToExcel('absence_histroy')">
															<i class="fa fa-arrow-down"></i> Export To Excel
														</button>
													</a>
												</div>
											</div>
										</div>
									</div>
                          
                          <div id="absence_histroy_wrap" class="table-responsive">
                                 
                           <div id="absence_histroy_content" class="adv-table">
                            		
                          <table class="table table-striped table-hover table-bordered" id="absence_histroy">
                             <thead>

                              <tr class="rowvis" style="background-color: #cacbce;">
                                <th>Employee Id</th>
                                <th>Employee Name</th>
								<th>Shift</th>
								<th>Department</th>
                                <th>Manager</th>
                                <th>Absence Date</th>
                                <th>Absence Days</th>
                                <th>Absence Reason</th>
                                <th>Sick Reason</th>
                                <th>Phone No</th>
                                <th>Point</th>	
                                <th>Call Taken By</th>	
                                <th>Date </th>
                                <th>Extn</th>	
                                <th>Time</th>							
                                <th>Time Of Call</th>                                
									
                              </tr>
                               </thead>
                             
                              <tbody>
                                                       
                              </tbody>
                          </table>
                      </div>
                      </div>
										
																			
                   <div class="col-lg-12">
					<div class="modal fade" id="myModal5" tabindex="-1"
					role="dialog" aria-labelledby="myModalLabel"
					aria-hidden="true" data-backdrop="static"
					data-keyboard="false">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button id="program-error-modal-close" type="button"
									class="close" data-dismiss="modal"
									aria-hidden="true">&times;</button>
								<h4 class="modal-title">Error / Warning (s)</h4>
							</div>
							<div class="modal-body">
								<!-- <div class="space15">&nbsp;</div> -->
								<div class="text-center">
									<span id="errorMessageModal"></span>
								</div>
								<!-- <div class="space15"></div> -->
							</div>
							<div class="modal-footer">
								<button class="btn btn-info" type="button"
									id="program-error-modal-ok" data-dismiss="modal">
									<i class="fa fa-save"></i>&nbsp;&nbsp;OK
								</button>
							</div>
						</div>
					</div>
				</div>
                                        <div class="row">
                                            <div class="space15 clearfix"></div>
                                  

      <!-- END Review / Confirm Section -->
      </div>
        </div>
      </section><!-- end panel section -->
      </div>
      </div>
      <!-- page end-->
      </section><!-- end wrapper site-min-height -->
      </section><!-- end #maincontent -->
      <!--main content end-->
          
      <!--footer start-->
      <footer class="site-footer">
         <div class="text-center">
            2017 &copy; Yokohama Tire Corporation. All rights reserved. The Yokohama Rubber Company Limited
            <a href="#" class="go-top">
            <i class="fa fa-angle-up"></i>
            </a>
         </div>
      </footer>
      <!--footer end-->
      </section>
      <!-- END section id="container" FIRST section after opening body tag  -->
       
     <!-- js placed at the end of the document so the pages load faster -->
   <!--  <script src="js/jquery.js"></script> -->
    <script src="resources/js/jquery-ui-1.9.2.custom.min.js"></script>
    <script src="resources/js/jquery-migrate-1.2.1.min.js"></script>
    <script src="resources/js/bootstrap.min.js"></script>
    <script class="include" type="text/javascript" src="resources/js/jquery.dcjqaccordion.2.7.js"></script>
    <script src="resources/js/jquery.scrollTo.min.js"></script>
    <script src="resources/js/jquery.nicescroll.js" type="text/javascript"></script>
    <script type="text/javascript" src="resources/assets/data-tables/jquery.dataTables.js"></script>
    <script type="text/javascript" src="resources/assets/data-tables/DT_bootstrap.js"></script>
    <script src="resources/js/respond.min.js" ></script>
    <!--select2-->
    <script type="text/javascript" src="resources/assets/select2/js/select2.min.js"></script>
    <!-- time out -->
    <script src="resources/js/jquery.userTimeout.js"></script>
    <!--right slidebar-->
    <script src="resources/js/slidebars.min.js"></script>
    <!--dynamic table initialization -->
    <script src="resources/js/dynamic_table_init.js"></script>
    <!--common script for all pages-->
    <script src="resources/js/common-scripts.js"></script>
      
	

      <script type="text/javascript">
      
      $(document).ready(function () {
    	
     	 $('#absence_histroy th').attr('style', 'padding-left: 20px !important;padding-right:20px !important');
          
          table=$("#absence_histroy").DataTable( {
                    oLanguage: {
                           "sEmptyTable": "No data available for this selection"
                           },
                    //processing: true,   
                    lengthMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]],    
                    
                  ajax: {
                      url: '/YTMM/v1/getEmployeeAbsenceHistory/0000000000',
                      dataSrc: "data",
                      type: "GET",
                      error: function(XMLHttpRequest, textStatus, errorThrown) { 
                    	  message = "<strong> Error :</strong> " + errorThrown + "<br><strong>Message :</strong> " + XMLHttpRequest.responseText;
      					$("#errorMessageModal").html(message);
      					$('#myModal5').modal('toggle');  
                      }, 
                  },
                
           
                  columns: [                         
                
                   { data: "id"},
                   { data: "employeeName"},
                   { data: "shift"},
                   { data: "department"},
                   { data: "manager"},
                   { data: "displayAbsenceDate"},
                   { data: "absenceDays"},
                   { data: "absenceReason"},
                   { data: "sickReason"},
                   { data: "phoneNo"},
                   { data: "point"},
                   { data: "callTakenBy"},
                   { data: "displayDate"},
                   { data: "extn"},
                   { data: "time"},
                   { data: "timeOfCall"}
                   
   
      				]
              });
    	  
		});
      
      function runReport() {
    	  
    	  if($('#employeeName').val().trim()){
			var url='/YTMM/v1/getEmployeeAbsenceHistory/'+$('#employeeName').val();
    	  }else{
    		  
    		  $('#errorMessageModal').html("Please enter an Employee Name to search");
			  $('#myModal5').modal('toggle');
			  $('#employeeName').val('');
    	  }
			
			table.ajax.url(url).load();
  	  }
  	  
      
      $( function() {
    	 
    	  $.ajax({ 
          	type: "GET",
          	dataType: "json",
         	url: '/YTMM/v1/getAllEmployeeDetails',
          	success: function(response){
          		 var availableTags = response;
           	   $( "#employeeName" ).autocomplete({
           	      source: availableTags
           	    });
           	 
          	},
          	failure: function(response){
          		alert("Wrongly done");
          	}
      	});  	  
    	     	
		  
    });
      
       
      
		
      </script>
		<script type="text/javascript" th:inline="javascript">
			$(document).ready(function() {			
				var modelAttributeValue = [[${loginUserNameValue}]];
				$("#loginUserName").html(modelAttributeValue);
				 var emp = [[${EmployeeInfo}]];
		 		   if((1==emp[0].ROLE_ID)||(2==emp[0].ROLE_ID)){		 			
		 			  $('#employeeName').prop('disabled', false);
		 		   }else{
		 			  $('#employeeName').val(modelAttributeValue); 
		 			  runReport();
		 		   }
			});
		</script>
       <!-- END JAVASCRIPTS -->
   </body>
</html>